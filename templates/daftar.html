<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Akun - PaTani</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='daftar.css') }}">
</head>
<body>
    <div class="register-wrapper">
        <div class="info-side">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo PaTani" class="logo">
            <h1>One Step to Pahlawan Agrikultur!</h1>
            <p>Bergabunglah dengan ribuan petani, akademisi, dan pakar lainnya. Mari berinovasi dan majukan pertanian Indonesia bersama.</p>
            <div class="login-link">
                <p>Sudah punya akun? <a href="{{ url_for('login') }}">Masuk di sini</a></p>
            </div>
        </div>
        <div class="form-side">
            <h2>Buat Akun Baru</h2>
            <form method="POST" action="{{ url_for('daftar_petani') }}" class="register-form" autocomplete="off">
                
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }} full-width">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <div class="form-group full-width">
                    <label for="name">Nama Lengkap</label>
                    <input type="text" id="name" name="name" placeholder="Masukkan nama lengkap Anda" required>
                </div>

                <div class="form-group">
                    <label for="dob">Tanggal Lahir</label>
                    <input type="date" id="dob" name="dob" required>
                </div>

                <div class="form-group">
                    <label for="gender">Jenis Kelamin</label>
                    <select id="gender" name="gender" required>
                        <option value="" disabled selected>-- Pilih Jenis Kelamin --</option>
                        <option value="Laki-laki">Laki-laki</option>
                        <option value="Perempuan">Perempuan</option>
                    </select>
                </div>

                <div class="form-group full-width">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" placeholder="contoh@email.com" required autocomplete="off">
                </div>

                <div class="form-group full-width">
                    <label for="phone">No. Telepon</label>
                    <input type="tel" id="phone" name="phone" placeholder="081234567890" required>
                </div>

                <div class="form-group full-width">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="Buat password yang kuat" required autocomplete="new-password">
                </div>

                <button type="submit" class="btn-submit">Daftar Sekarang</button>
            </form>
        </div>
    </div>
    
    <script>
        // Auto location detection for new user registration
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('.register-form');
            
            form.addEventListener('submit', function(e) {
                // Let the form submit normally
                console.log('Registration form submitted');
                
                // After successful registration, user will be redirected to login
                // Location detection will happen during login flow
            });
        });
        
        // Optional: Location detection for registration preview
        function detectLocationForRegistration() {
            if (!('geolocation' in navigator)) {
                console.log('Geolocation not supported');
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    console.log(`Registration location preview: ${lat}, ${lon}`);
                    
                    // Store in sessionStorage for after login
                    sessionStorage.setItem('pendingLocation', JSON.stringify({
                        latitude: lat,
                        longitude: lon,
                        timestamp: Date.now()
                    }));
                    
                    showRegistrationMessage('success', 'Lokasi terdeteksi untuk setup otomatis setelah login!', 3000);
                },
                (error) => {
                    console.log('Registration location detection failed:', error.message);
                    showRegistrationMessage('info', 'Location akan dideteksi setelah login', 2000);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 300000
                }
            );
        }
        
        function showRegistrationMessage(type, message, duration = 3000) {
            // Remove existing messages
            const existing = document.querySelectorAll('.registration-location-msg');
            existing.forEach(el => el.remove());
            
            const msgDiv = document.createElement('div');
            msgDiv.className = 'registration-location-msg';
            msgDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                max-width: 300px;
                padding: 10px 14px;
                border-radius: 6px;
                font-size: 13px;
                font-family: 'Inter', sans-serif;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                animation: slideIn 0.3s ease-out;
            `;
            
            // Set color based on type
            const colors = {
                'info': { bg: '#e3f2fd', color: '#1976d2' },
                'success': { bg: '#e8f5e8', color: '#388e3c' },
                'warning': { bg: '#fff3cd', color: '#f57c00' }
            };
            
            const style = colors[type] || colors.info;
            msgDiv.style.backgroundColor = style.bg;
            msgDiv.style.color = style.color;
            msgDiv.textContent = message;
            
            document.body.appendChild(msgDiv);
            
            setTimeout(() => {
                if (msgDiv.parentNode) {
                    msgDiv.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => msgDiv.remove(), 300);
                }
            }, duration);
        }
        
        // CSS for animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
